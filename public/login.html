<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8"/>
	<title>Login</title>
	<link rel="stylesheet" type="text/css" href="style.css?ver=0">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
	
<body>
    <form action="/a/login" method="POST" id="loginForm">
        <h1>Login</h1>

        <label class="sr-only" for="username">Username</label>
        <input
            type="text"
            id="username"
            name="username"
            placeholder="Username"
            required
        >

        <label class="sr-only" for="password">Password</label>
        <input
            type="password"
            id="password"
            name="password"
            placeholder="Password"
            required
        >

        <div class="forgot-wrapper">
            <button type="submit">Login</button>
            <a href="/forgot-password" class="forgot">Forgot password?</a>
        </div>

        <a href="/register.html" class="small">Sign Up</a></p>
    </form>

    <script>
        (async () => {
            const key_pair = await crypto.subtle.generateKey(
                { name: 'ECDH', namedCurve: 'P-256' },
                true,
                ['deriveKey']
            );

            const raw_pub = await crypto.subtle.exportKey('raw', key_pair.publicKey);
            const pub_bytes = new Uint8Array(raw_pub);
            const client_pub_hex = Array.from(pub_bytes)
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');

            const form = document.getElementById('loginForm');
            form.addEventListener('submit', e => {
                e.preventDefault();

                let inp = document.getElementById('client_pub');
                if (!inp) {
                    inp = document.createElement('input');
                    inp.type = 'hidden';
                    inp.name = 'client_pub';
                    inp.id = 'client_pub';
                    form.appendChild(inp);
                }
                inp.value = client_pub_hex;

                form.submit();
            });
        })();
    </script>

</body>

</html>

